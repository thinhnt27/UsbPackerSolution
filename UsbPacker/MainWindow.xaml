<Window x:Class="UsbPacker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="USB Video Packer" Height="593" Width="1331"
        WindowStartupLocation="CenterScreen" MinWidth="720" MinHeight="420">
    <Window.Resources>
        <Thickness x:Key="Gap">8</Thickness>
        <Style x:Key="Btn" TargetType="Button">
            <Setter Property="Margin" Value="6,0"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="MinWidth" Value="110"/>
        </Style>
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="0,0,12,0"/>
            <Setter Property="Padding" Value="6"/>
        </Style>
        <Style TargetType="TextBlock" x:Key="Hint">
            <Setter Property="Foreground" Value="Gray"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <DockPanel Grid.Row="0" Margin="8,8,8,8" Grid.ColumnSpan="2">
            <TextBlock Text="USB Video Packer" FontSize="18" FontWeight="Bold"/>
            <TextBlock Text="  ·  Embed USB hashes into EXE" Margin="6,4,0,0"
                       Foreground="Gray"/>
        </DockPanel>

        <!-- Mode selector + Drive actions -->
        <DockPanel Grid.Row="1" LastChildFill="False" Margin="8,8,8,8" Grid.ColumnSpan="2">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="Mode:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <RadioButton x:Name="UseUsbRadio" Content="Use selected USBs" Margin="0,0,8,0" IsChecked="True" Checked="ModeRadio_Checked"/>
                <RadioButton x:Name="UseJsonRadio" Content="Import JSON" Margin="0,0,8,0" Checked="ModeRadio_Checked"/>
            </StackPanel>

            <!-- USB controls group (we will toggle visibility) -->
            <StackPanel x:Name="UsbControlsPanel" Orientation="Horizontal" Margin="12,0,0,0">
                <Button x:Name="RefreshDrivesBtn" Content="Refresh" Style="{StaticResource Btn}" Click="RefreshDrivesBtn_Click"/>
                <Button x:Name="SelectAllDrivesBtn" Content="Select all" Style="{StaticResource Btn}" Click="SelectAllDrivesBtn_Click"/>
                <Button x:Name="DeselectAllDrivesBtn" Content="Deselect" Style="{StaticResource Btn}" Click="DeselectAllDrivesBtn_Click"/>
                <Separator Margin="8,0"/>
                <Button x:Name="AddSelectedUsbHashesBtn" Content="Add → hashes" Style="{StaticResource Btn}" Click="AddSelectedUsbHashesBtn_Click" MinWidth="140"/>
                <Button x:Name="RefreshSelectedUsbHashesBtn" Content="Replace → hashes" Style="{StaticResource Btn}" Click="RefreshSelectedUsbHashesBtn_Click" MinWidth="150"/>

                <!-- EXPORT btn nằm ở đây: chỉ hiện khi UsbControlsPanel visible -->
                <Button x:Name="ExportHashesBtn" Content="Export hashes" Style="{StaticResource Btn}" Click="ExportHashesBtn_Click" MinWidth="120"/>
            </StackPanel>

            <!-- JSON import control (visible only in JSON mode) -->
            <StackPanel x:Name="JsonControlsPanel" Orientation="Horizontal" Visibility="Collapsed" Margin="12,0,0,0">
                <Button x:Name="ImportHashesBtn" Content="Import hashes" Style="{StaticResource Btn}" Click="ImportHashesBtn_Click" MinWidth="140"/>
                <!-- Lưu ý: Xoá Export khỏi đây (đã chuyển sang UsbControlsPanel) -->
            </StackPanel>

            <TextBlock x:Name="HashesCountText" Text="Hashes: 0" Margin="12,6,0,0" Foreground="DarkGreen" FontWeight="SemiBold"/>
        </DockPanel>

        <!-- Main content -->
        <Grid Grid.Row="2" Margin="8,8,8,8" Grid.ColumnSpan="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="340"/>
            </Grid.ColumnDefinitions>

            <!-- Files -->
            <GroupBox Header="Files to pack" Grid.Column="0">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,6,0,0">
                        <Button x:Name="AddFilesBtn" Content="Add files..." Style="{StaticResource Btn}" Click="AddFilesBtn_Click"/>
                        <Button x:Name="RemoveBtn" Content="Remove selected" Style="{StaticResource Btn}" Click="RemoveBtn_Click"/>
                    </StackPanel>
                    <ListBox x:Name="FilesList" Margin="0" SelectionMode="Extended"/>
                </DockPanel>
            </GroupBox>

            <!-- Drives -->
            <StackPanel Grid.Column="1">
                <GroupBox Header="Detected removable drives" Margin="0,0,0,12">
                    <StackPanel>
                        <ListBox x:Name="DrivesListBox" Height="220" SelectionMode="Extended" BorderThickness="1">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <DockPanel LastChildFill="True">
                                        <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}"
                                                  VerticalAlignment="Center" Margin="4,0,6,0"/>
                                        <TextBlock Text="{Binding Display}" VerticalAlignment="Center" FontFamily="Consolas"/>
                                    </DockPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        <TextBlock Text="Tick drives, then use “Add → hashes” to record."
                                   Style="{StaticResource Hint}" Margin="0,6,0,0"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </Grid>

        <!-- Progress -->
        <DockPanel Grid.Row="3" Margin="8,8,8,8" Grid.ColumnSpan="2">
            <Button x:Name="StartBtn" Content="Create EXE(s) → Done"
                    Click="StartBtn_Click" Width="300" Height="36"
                    Background="#FF2D8CFF" Foreground="White" Margin="0,0,12,0"/>
            <ProgressBar x:Name="Progress" Height="20" Minimum="0" Maximum="100" Margin="0,8,12,0" Width="Auto"/>
            <TextBlock x:Name="ProgressPercent" VerticalAlignment="Center" Text="0%" Width="40"/>
        </DockPanel>

        <!-- Status -->
        <StackPanel Grid.Row="4" Margin="8,8,8,8" Grid.ColumnSpan="2">
            <TextBlock x:Name="StatusText" Text="Ready" FontWeight="SemiBold" Foreground="DarkGreen"/>
            <TextBlock Text="Output: ./Done (next to UsbPacker.exe)" Style="{StaticResource Hint}"/>
        </StackPanel>
    </Grid>
</Window>
